#!/usr/bin/env bash
# Go environment settings
export GODEBUG=netdns=go
export GOPROXY=https://proxy.golang.org,direct
export GOINSECURE=proxy.golang.org,goproxy.io
# export GIT_SSL_NO_VERIFY=1  # Temporary if SSL issues persist

# Create .venv (optionally honor .python-version)
if [[ -f .python-version ]]; then
    UV_PYVER=$(cat .python-version)
else
    UV_PYVER=""
fi
if [[ ! -d .venv ]]; then
    if [[ -n "$UV_PYVER" ]]; then uv venv --python "$UV_PYVER"; else uv venv; fi
fi
# Activate venv on PATH
export VIRTUAL_ENV="$PWD/.venv"
if type -t PATH_add >/dev/null 2>&1; then
    PATH_add "$VIRTUAL_ENV/bin"
else
    export PATH="$VIRTUAL_ENV/bin:$PATH"
fi
# Sync all dependency groups from the lock
uv sync --locked --all-groups --all-extras
